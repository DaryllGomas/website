<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enter Zen From There</title>
    <!-- Preload critical images -->
    <link rel="preload" href="mountain-path.jpg" as="image">
    <link rel="preload" href="cosmic.jpg" as="image">
    <link rel="preload" href="Future.JPEG" as="image">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevents scrollbars from appearing */
            width: 100%;
            height: 100%;
            position: fixed; /* Ensures the page doesn't scroll at all */
        }
        
        body {
            font-family: 'Georgia', serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f0;
            background-image: linear-gradient(rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.8)), url('mountain-path.jpg');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            transition: all 0.5s ease;
        }
        
        body.dark-mode {
            color: #f0f0f0;
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('mountain-path.jpg');
        }
        
        .container {
            max-width: 800px;
            width: 90%;
            margin: 0 auto;
            padding: 20px 30px;
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            margin-top: 20px;
            margin-bottom: 20px;
            transition: all 0.5s ease;
            max-height: 95vh; /* Increased max height */
            overflow: hidden; /* Hide scrollbars completely */
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
        }
        
        body.dark-mode .container {
            background-color: rgba(30, 30, 30, 0.9);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        header {
            text-align: center;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
            transition: all 0.5s ease;
        }
        
        body.dark-mode header {
            border-bottom: 1px solid #444;
        }
        
        h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
            color: #333;
            transition: all 0.5s ease;
        }
        
        body.dark-mode h1 {
            color: #f0f0f0;
        }
        
        h2 {
            font-size: 1.2em;
            font-weight: normal;
            font-style: italic;
            color: #666;
            margin-top: 0;
            transition: all 0.5s ease;
        }
        
        body.dark-mode h2 {
            color: #aaa;
        }
        
        .content {
            padding: 15px 0;
            transition: all 0.5s ease;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        p {
            margin-bottom: 0.8em;
            transition: all 0.5s ease;
            line-height: 1.6;
        }
        
        body.dark-mode p {
            color: #ddd;
        }
        
        footer {
            text-align: center;
            padding: 10px 0;
            color: #666;
            font-size: 0.9em;
            border-top: 1px solid #ddd;
            transition: all 0.5s ease;
        }
        
        body.dark-mode footer {
            color: #aaa;
            border-top: 1px solid #444;
        }
        
        .logo {
            max-width: 120px;
            max-height: 120px;
            width: 120px;
            height: 120px;
            object-fit: cover;
            margin-bottom: 10px;
            border-radius: 50%;
            transition: all 2s ease;
        }
        
        /* Logo transition when in cosmic mode */
        .logo-transitioning {
            opacity: 0.1; /* Initial fade out before changing */
            transition: opacity 2.5s ease;
        }
        
        .cosmic-mode .logo-transitioning {
            opacity: 1; /* Fade back in after image is changed */
            transition: opacity 2.5s ease;
        }
        
        @media (max-width: 600px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
        }
        
        /* Toggle buttons */
        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border: none;
        }
        
        body.dark-mode .control-btn {
            background-color: rgba(60, 60, 60, 0.8);
            color: #fff;
        }
        
        .control-btn:hover {
            transform: scale(1.1);
        }
        
        /* Breathing circle animation */
        .breathing-circle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(100, 149, 237, 0.5);
            animation: breathing 5s infinite ease-in-out;
            display: none;
        }
        
        @keyframes breathing {
            0% { transform: scale(0.9); background-color: rgba(100, 149, 237, 0.5); }
            25% { transform: scale(1.0); background-color: rgba(100, 149, 237, 0.7); }
            50% { transform: scale(1.2); background-color: rgba(100, 149, 237, 0.9); }
            75% { transform: scale(1.0); background-color: rgba(100, 149, 237, 0.7); }
            100% { transform: scale(0.9); background-color: rgba(100, 149, 237, 0.5); }
        }
        
        /* Fade-in animation for content */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 1.5s ease forwards;
            opacity: 0;
        }
        
        .delay-1 { animation-delay: 0.2s; }
        .delay-2 { animation-delay: 0.4s; }
        .delay-3 { animation-delay: 0.6s; }
        .delay-4 { animation-delay: 0.8s; }
        .delay-5 { animation-delay: 1.0s; }
        
        /* Falling leaves */
        .leaf {
            position: absolute;
            width: 20px;
            height: 20px;
            background: rgba(139, 195, 74, 0.5);
            border-radius: 0 50% 50% 50%;
            transform: rotate(45deg);
            pointer-events: none;
            filter: drop-shadow(0px 0px 1px rgba(0, 0, 0, 0.1));
            z-index: -1;
        }
        
        /* Zen Garden */
        .zen-garden {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 280px;
            height: 160px;
            background-color: rgba(245, 245, 240, 0.9);
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            z-index: 10;
            transition: all 0.3s ease;
            transform-origin: bottom right;
        }
        
        .zen-garden-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 10px;
            background-color: rgba(200, 200, 200, 0.5);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .zen-garden-title {
            font-size: 0.9em;
            margin: 0;
            font-weight: normal;
        }
        
        .zen-garden-reset {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9em; /* Slightly smaller than close */
            padding: 0 5px;
            color: #555;
            transition: color 0.3s ease;
        }
        
        .zen-garden-reset:hover {
            color: #000;
        }
        
        body.dark-mode .zen-garden-reset {
            color: #aaa;
        }
        
        body.dark-mode .zen-garden-reset:hover {
            color: #fff;
        }
        
        body.dark-mode .zen-garden-header {
            background-color: rgba(50, 50, 50, 0.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .zen-garden {
            background-color: rgba(30, 30, 30, 0.9);
        }
        
        .sand {
            width: 100%;
            height: 100%;
            background-color: #f0e6d2;
            cursor: pointer;
        }
        
        body.dark-mode .sand {
            background-color: #3a3a3a;
        }
        
        .stone {
            position: absolute;
            background-color: #777;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2);
            cursor: grab;
            user-select: none;
        }
        
        .stone:active {
            cursor: grabbing;
        }
        
        .stone:hover {
            filter: brightness(1.1);
        }
        
        /* Sand lines */
        .line {
            position: absolute;
            background-color: #e5dbc5;
            pointer-events: none;
        }
        
        body.dark-mode .line {
            background-color: #444;
        }
        
        /* Hidden message */
        .hidden-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            z-index: 100;
            display: none;
            text-align: center;
            max-width: 400px;
        }
        
        body.dark-mode .hidden-message {
            background-color: rgba(30, 30, 30, 0.95);
        }
        
        .hidden-message p {
            margin-bottom: 15px;
        }
        
        .hidden-message button {
            background-color: #4b79a1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .hidden-message button:hover {
            background-color: #3a678f;
        }
        
        /* Clickable zen words */
        .zen-word {
            text-decoration: none;
            color: inherit;
            border-bottom: 1px dotted #888;
            cursor: pointer;
            position: relative;
        }
        
        .zen-word:hover {
            color: #4b79a1;
        }
        
        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.95);
            padding: 8px 12px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            font-size: 0.9em;
            width: 220px;
            display: none;
            z-index: 100;
            text-align: center;
        }
        
        body.dark-mode .tooltip {
            background-color: rgba(50, 50, 50, 0.95);
        }
        
        .zen-word:hover .tooltip {
            display: block;
        }
        
        /* Water ripples */
        .ripple {
            position: absolute;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            animation: rippleEffect 2s linear forwards;
            pointer-events: none;
        }
        
        @keyframes rippleEffect {
            0% {
                width: 0;
                height: 0;
                opacity: 0.8;
            }
            100% {
                width: 200px;
                height: 200px;
                opacity: 0;
            }
        }
        
        body.dark-mode .ripple {
            border-color: rgba(150, 180, 255, 0.3);
        }
        
        /* Fireflies */
        .firefly {
            position: fixed;
            width: 3px;
            height: 3px;
            background-color: rgba(255, 255, 190, 0.7);
            border-radius: 50%;
            box-shadow: 0 0 5px 1px rgba(255, 255, 100, 0.5);
            pointer-events: none;
            opacity: 0;
        }
        
        /* Meditation timer */
        .meditation-timer {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            text-align: center;
            z-index: 100;
            width: 300px;
        }
        
        body.dark-mode .meditation-timer {
            background-color: rgba(40, 40, 40, 0.95);
        }
        
        .timer-display {
            font-size: 3rem;
            font-weight: 300;
            margin: 20px 0;
            font-family: monospace;
        }
        
        .timer-controls {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        
        .timer-btn {
            background-color: #4b79a1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            width: 80px;
        }
        
        .timer-btn:hover {
            background-color: #3a678f;
        }
        
        .timer-options {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        
        .timer-option {
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid #ddd;
        }
        
        body.dark-mode .timer-option {
            border-color: #555;
        }
        
        .timer-option.active {
            background-color: #4b79a1;
            color: white;
            border-color: #4b79a1;
        }
        
        /* Parallax effect */
        .parallax-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 120%;
            height: 120%;
            background-image: url('mountain-path.jpg');
            background-size: cover;
            z-index: -2;
            transform: translate(-10%, -10%);
            will-change: transform; /* Optimizes for animation */
            transition: opacity 3s ease; /* Slower transition for smooth fade */
        }
        
        /* Add this rule to hide the mountain background when cosmic mode is active */
        body.cosmic-mode .parallax-bg {
            opacity: 0;
        }
        
        body.dark-mode .parallax-bg {
            filter: brightness(0.5) saturate(0.7);
        }
        
        /* Add volume control slider styles */
        .volume-control {
            display: none;
            position: fixed;
            top: 70px;
            right: 20px;
            width: 120px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
            animation: fadeIn 0.3s ease;
        }
        
        body.dark-mode .volume-control {
            background-color: rgba(40, 40, 40, 0.9);
        }
        
        .volume-slider {
            width: 100%;
            cursor: pointer;
        }
        
        .volume-title {
            font-size: 0.8em;
            margin-bottom: 5px;
            text-align: center;
            color: #333;
        }
        
        body.dark-mode .volume-title {
            color: #ddd;
        }
        
        .volume-control + .volume-control {
            top: 140px; /* Position second volume control below the first one */
        }
        
        /* Add CSS for floating quotes after the volume control styles */
        .floating-quote {
            position: fixed;
            padding: 15px 25px;
            background-color: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            font-style: italic;
            max-width: 300px;
            text-align: center;
            opacity: 0;
            transition: opacity 3s ease;
            z-index: 5;
            pointer-events: none;
            overflow: hidden; /* Prevent text from overflowing */
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        body.dark-mode .floating-quote {
            background-color: rgba(0, 0, 0, 0.15);
            color: #f0f0f0;
        }
        
        .quote-author {
            font-size: 0.9em;
            margin-top: 8px;
            opacity: 0.8;
        }
        
        /* Space scene styles */
        .space-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -3; /* Behind parallax by default */
            background-image: url('cosmic.jpg');
            background-size: cover;
            background-position: center;
            opacity: 0;
            transition: opacity 5s ease, transform 20s ease-in-out, z-index 0s linear;
            pointer-events: none;
            transform: scale(1);
        }
        
        /* Add animation for cosmic mode */
        .cosmic-mode .space-scene {
            z-index: -1; /* Bring it to front when active */
            opacity: 1;
            transform: scale(1.05);
            animation: cosmic-drift 30s infinite alternate ease-in-out;
            filter: brightness(1.2) saturate(1.2) hue-rotate(0deg);
        }
        
        @keyframes cosmic-drift {
            0% {
                background-position: center center;
                transform: scale(1.05);
                filter: brightness(1.2) saturate(1.2) hue-rotate(0deg);
            }
            50% {
                background-position: 51% 49%;
                transform: scale(1.1);
                filter: brightness(1.3) saturate(1.3) hue-rotate(5deg);
            }
            100% {
                background-position: 49% 51%;
                transform: scale(1.08);
                filter: brightness(1.25) saturate(1.25) hue-rotate(-5deg);
            }
        }
        
        .cosmic-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .cosmic-mode .container {
            background-color: rgba(10, 10, 30, 0.6);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(100, 150, 255, 0.2);
            box-shadow: 0 0 30px rgba(50, 100, 255, 0.15);
            transition: all 3s ease;
        }
        
        .cosmic-mode p, .cosmic-mode h1, .cosmic-mode h2, .cosmic-mode footer {
            color: #e0e0ff;
            text-shadow: 0 0 15px rgba(150, 200, 255, 0.3);
            transition: all 3s ease;
        }
        
        .cosmic-mode .logo {
            box-shadow: 0 0 20px rgba(100, 150, 255, 0.5);
            transition: all 5s ease;
            content: url('Future.JPEG'); /* Changes the image source in cosmic mode */
            transform: scale(1.05);
            filter: brightness(1.2) saturate(1.2);
        }
        
        .cosmic-mode a, .cosmic-mode span {
            color: #a0c0ff;
            transition: all 3s ease;
        }
        
        .cosmic-mode .zen-word {
            border-bottom-color: rgba(150, 200, 255, 0.4);
        }
        
        .cosmic-mode .tooltip {
            background-color: rgba(20, 30, 60, 0.9);
            color: #d0e0ff;
        }
        
        .cosmic-pulse {
            animation: cosmicPulse 12s infinite ease-in-out;
        }
        
        @keyframes cosmicPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .zen-garden-close {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            padding: 0;
            color: #555;
            transition: color 0.3s ease;
        }
        
        .zen-garden-close:hover {
            color: #000;
        }
        
        /* Style for the new reset button */
        .zen-garden-reset {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9em; /* Slightly smaller than close */
            padding: 0 5px;
            color: #555;
            transition: color 0.3s ease;
        }

        .zen-garden-reset:hover {
            color: #000;
        }
        
        body.dark-mode .zen-garden-close {
            color: #aaa;
        }
    </style>
</head>
<body class="dark-mode">
    <div class="parallax-bg"></div>
    <div class="space-scene" id="spaceScene"></div>
    
    <div class="container">
        <header class="fade-in">
            <img src="mountain-path.jpg" alt="mountain-path Logo" class="logo">
            <h1>Enter Zen From There</h1>
        </header>
        
        <div class="content">
            <p class="fade-in delay-1">A Zen Master was walking in silence with one of his disciples along a mountain trail. When they came to an ancient cedar tree, they sat down under it for a simple meal of some rice and vegetables. After the meal, the disciple, a young monk who had not yet found the key to the mystery of <span class="zen-word">Zen<span class="tooltip">Zen is not something to understand, but to experience directly. It points to your true nature beyond thinking.</span></span>, broke the silence by asking the Master, "Master, how do I enter Zen?"</p>
            
            <p class="fade-in delay-2">He was, of course, inquiring how to enter the state of <span class="zen-word">consciousness<span class="tooltip">Pure awareness without the interference of thought - your natural state.</span></span> which is Zen.</p>
            
            <p class="fade-in delay-2">The master remained silent. Almost five minutes passed while the disciple anxiously waited for an answer. He was about to ask another question when the Master suddenly spoke. "Do you hear the sound of that mountain stream?"</p>
            
            <p class="fade-in delay-3">The disciple had been busy <span class="zen-word">thinking<span class="tooltip">Thinking is useful, but it can become an obstacle to direct experience. Beyond thinking lies wisdom.</span></span> about the meaning of Zen. Now, as he began to listen to the sound, his noisy mind subsided. At first he heard nothing. Then, his thinking gave way to heightened alertness, and suddenly he did hear the hardly perceptible murmur of a small stream in the far distance.</p>
            
            <p class="fade-in delay-3">"Yes, I can hear it now," he said.</p>
            
            <p class="fade-in delay-4">The Master raised his finger and, with a look in his eyes that in some way was both fierce and gentle, said, "Enter Zen from there."</p>
            
            <p class="fade-in delay-4">The disciple was stunned. It was his first <span class="zen-word">satori<span class="tooltip">Satori is a glimpse of enlightenment - a moment when the veil of thoughts drops and reality is seen directly.</span></span> — a flash of enlightenment. He knew what Zen was without knowing what it was that he knew!</p>
            
            <p class="fade-in delay-4">They continued on their journey in silence. The disciple was amazed at the <span class="zen-word">aliveness<span class="tooltip">When mental noise subsides, the world appears vibrant, fresh and alive - as it truly is.</span></span> of the world around him. He experienced everything as if for the first time. Gradually, however, he started thinking again. The alert stillness became covered up again by mental noise, and before long he had another question. "Master," he said, "I have been thinking. What would you have said if I hadn't been able to hear the mountain stream?" The Master stopped, looked at him, raised his finger and said, "Enter Zen from there."</p>
        </div>
        
        <footer class="fade-in delay-5">
            <p>Found this hidden gem? <span id="secret-trigger">Enter Zen from here</span>.</p>
        </footer>
    </div>
    
    <div class="breathing-circle"></div>
    <div class="zen-garden">
        <div class="zen-garden-header">
            <h4 class="zen-garden-title">Zen Garden</h4>
            <button class="zen-garden-reset" id="reset-zen-garden" title="Reset Garden">🔄</button>
            <button class="zen-garden-close" id="close-zen-garden" title="Close Garden">×</button>
        </div>
        <div class="sand" id="sand"></div>
    </div>
    
    <div class="hidden-message">
        <p>"The true purpose of Zen is to see things as they are, to observe things as they are, and to let everything go as it goes."</p>
        <p>— Shunryu Suzuki</p>
        <button id="close-message">Continue the journey</button>
    </div>
    
    <div class="meditation-timer">
        <h3>Meditation Timer</h3>
        <div class="timer-options">
            <div class="timer-option active" data-time="5">5 min</div>
            <div class="timer-option" data-time="10">10 min</div>
            <div class="timer-option" data-time="15">15 min</div>
        </div>
        <div class="timer-display">05:00</div>
        <div class="timer-controls">
            <button class="timer-btn" id="start-timer">Start</button>
            <button class="timer-btn" id="close-timer">Close</button>
        </div>
    </div>
    
    <div class="volume-control" id="om-volume-control">
        <div class="volume-title">OM Volume</div>
        <input type="range" min="0" max="1" step="0.1" value="0.5" class="volume-slider" id="om-volume-slider">
    </div>
    
    <div class="volume-control" id="cosmic-volume-control">
        <div class="volume-title">Cosmic Meditation Volume</div>
        <input type="range" min="0" max="1" step="0.1" value="0.5" class="volume-slider" id="cosmic-volume-slider">
    </div>
    
    <div class="controls">
        <button class="control-btn" id="darkModeToggle" title="Toggle Light/Dark Mode">
            🌙
        </button>
        <button class="control-btn" id="soundToggle" title="Toggle Stream Sound">
            🔇
        </button>
        <button class="control-btn" id="breatheToggle" title="Toggle Breathing Guide">
            🧘
        </button>
        <button class="control-btn" id="cosmicToggle" title="Toggle Cosmic Meditation">
            🌌
        </button>
        <button class="control-btn" id="zenGardenToggle" title="Toggle Zen Garden">
            ☯️
        </button>
        <button class="control-btn" id="leavesToggle" title="Toggle Falling Leaves">
            🍃
        </button>
        <button class="control-btn" id="timerToggle" title="Meditation Timer">
            ⏱️
        </button>
        <button class="control-btn" id="parallaxToggle" title="Toggle Parallax Effect">
            🖱️
        </button>
    </div>
    
    <audio id="streamSound" loop preload="auto">
        <source src="https://soundbible.com/mp3/creek-daniel_simon.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="bellSound" preload="auto">
        <source src="https://soundbible.com/mp3/meditative-bell-sound-1-12752.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="omSound" loop preload="auto">
        <source src="OM.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="cosmicSound" preload="auto">
        <source src="KTN.mp3" type="audio/mpeg">
    </audio>
    
    <!-- Sound effects for Zen Garden -->
    <audio id="rakeSound" preload="auto">
        <source src="https://soundbible.com/mp3/sand-shovel-1-6022.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="stonePlaceSound" preload="auto">
        <source src="https://soundbible.com/mp3/rock-destroy-2-6304.mp3" type="audio/mpeg">
    </audio>
    
    <script src="js/modernizr-2.6.2.min.js"></script>
    <!-- FOR IE9 below -->
    <!--[if lt IE 9]>
    <script src="js/respond.min.js"></script>
    <![endif]-->
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Debug audio loading
            console.log("DOM fully loaded");
            
            // Fix zen garden button icon
            document.getElementById('zenGardenToggle').textContent = '☯️';
            
            // Check if cosmic.jpg exists and is loadable
            const cosmicTest = new Image();
            cosmicTest.onload = function() {
                console.log("cosmic.jpg loaded successfully");
            };
            cosmicTest.onerror = function() {
                console.error("Error loading cosmic.jpg - please check the file exists in the correct location");
            };
            cosmicTest.src = 'cosmic.jpg';
            
            const streamSound = document.getElementById('streamSound');
            const bellSound = document.getElementById('bellSound');
            const omSound = document.getElementById('omSound');
            const cosmicSound = document.getElementById('cosmicSound');
            // Get references to Zen Garden sound effects
            const rakeSound = document.getElementById('rakeSound');
            const stonePlaceSound = document.getElementById('stonePlaceSound');
            
            // Set initial volume of sound effects (very low)
            rakeSound.volume = 0.2;
            stonePlaceSound.volume = 0.3;
            
            console.log("Stream sound ready state:", streamSound.readyState);
            console.log("Bell sound ready state:", bellSound.readyState);
            console.log("OM sound ready state:", omSound.readyState);
            
            // Initialize variables for fireflies
            let firefliesActive = false;
            let fireflies = [];
            
            // Check if OM.mp3 exists
            const omAudioElement = document.querySelector("#omSound source");
            console.log("OM audio source:", omAudioElement.src);
            
            // Initialize fireflies since dark mode is default
            initFireflies();
            
            // Dark mode toggle
            const darkModeToggle = document.getElementById('darkModeToggle');
            darkModeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                darkModeToggle.textContent = document.body.classList.contains('dark-mode') ? '🌙' : '☀️';
                
                // Initialize fireflies in dark mode
                if (document.body.classList.contains('dark-mode') && !firefliesActive) {
                    initFireflies();
                } else if (!document.body.classList.contains('dark-mode') && firefliesActive) {
                    clearFireflies();
                }
            });
            
            // Sound toggle
            const soundToggle = document.getElementById('soundToggle');
            let soundPlaying = false;
            
            soundToggle.addEventListener('click', function() {
                console.log("Sound toggle clicked. Current state:", soundPlaying);
                
                if (soundPlaying) {
                    console.log("Pausing stream sound");
                    streamSound.pause();
                    soundToggle.textContent = '🔇';
                    omVolumeControl.style.display = 'none';
                    cosmicVolumeControl.style.display = 'none';
                } else {
                    console.log("Playing stream sound");
                    streamSound.play()
                        .then(() => console.log("Stream sound playing successfully"))
                        .catch(e => console.error("Audio playback failed:", e));
                    soundToggle.textContent = '🔊';
                    omVolumeControl.style.display = 'block';
                    // Only show cosmic volume control if cosmic mode is active
                    if (cosmicActive) {
                        cosmicVolumeControl.style.display = 'block';
                    }
                }
                soundPlaying = !soundPlaying;
            });
            
            // Breathing guide toggle
            const breatheToggle = document.getElementById('breatheToggle');
            const breathingCircle = document.querySelector('.breathing-circle');
            const omVolumeControl = document.getElementById('om-volume-control');
            const omVolumeSlider = document.getElementById('om-volume-slider');
            let breathingActive = false;
            
            breatheToggle.addEventListener('click', function() {
                console.log("Breathing toggle clicked. Current state:", breathingActive);
                
                if (breathingActive) {
                    console.log("Stopping breathing animation and OM sound");
                    breathingCircle.style.display = 'none';
                    omSound.pause();
                    omSound.currentTime = 0;
                } else {
                    console.log("Starting breathing animation and OM sound");
                    breathingCircle.style.display = 'block';
                    
                    // Try to play with user gesture
                    const playPromise = omSound.play();
                    
                    if (playPromise !== undefined) {
                        playPromise
                            .then(() => console.log("OM sound playing successfully"))
                            .catch(e => {
                                console.error("OM sound playback failed:", e);
                                
                                // Add a visible notification for the user
                                const notification = document.createElement('div');
                                notification.style.position = 'fixed';
                                notification.style.top = '20px';
                                notification.style.left = '50%';
                                notification.style.transform = 'translateX(-50%)';
                                notification.style.padding = '10px 15px';
                                notification.style.backgroundColor = 'rgba(255, 0, 0, 0.7)';
                                notification.style.color = 'white';
                                notification.style.borderRadius = '5px';
                                notification.style.zIndex = '1000';
                                notification.textContent = "Click anywhere to enable sound";
                                document.body.appendChild(notification);
                                
                                // Try to play on next user interaction
                                const clickHandler = function() {
                                    console.log("Document clicked, trying to play OM sound again");
                                    omSound.play()
                                        .then(() => {
                                            console.log("OM sound playing after click");
                                            notification.remove();
                                        })
                                        .catch(e2 => console.error("Second attempt failed:", e2));
                                    document.removeEventListener('click', clickHandler);
                                };
                                
                                document.addEventListener('click', clickHandler);
                                
                                // Remove notification after 5 seconds
                                setTimeout(() => {
                                    if (notification.parentNode) {
                                        notification.parentNode.removeChild(notification);
                                    }
                                }, 5000);
                            });
                    }
                }
                breathingActive = !breathingActive;
            });
            
            omVolumeSlider.addEventListener('input', function() {
                omSound.volume = this.value;
            });
            
            // Secret message
            const secretTrigger = document.getElementById('secret-trigger');
            const hiddenMessage = document.querySelector('.hidden-message');
            const closeMessage = document.getElementById('close-message');
            
            secretTrigger.addEventListener('click', function() {
                hiddenMessage.style.display = 'block';
            });
            
            closeMessage.addEventListener('click', function() {
                hiddenMessage.style.display = 'none';
            });
            
            // Zen Garden
            const zenGardenToggle = document.getElementById('zenGardenToggle');
            const zenGarden = document.querySelector('.zen-garden');
            const closeZenGarden = document.getElementById('close-zen-garden');
            const resetZenGarden = document.getElementById('reset-zen-garden');
            let zenGardenActive = false;
            let stones = [];
            let activeStone = null;
            let lines = [];
            let isRaking = false;
            let lastX, lastY;
            
            zenGardenToggle.addEventListener('click', function() {
                zenGarden.style.display = 'block';
                zenGardenActive = true;
                if (stones.length === 0) {
                    initZenGarden();
                }
            });
            
            closeZenGarden.addEventListener('click', function() {
                zenGarden.style.display = 'none';
                zenGardenActive = false;
            });
            
            const sand = document.getElementById('sand');
            
            function initZenGarden() {
                // Create stones
                for (let i = 0; i < 5; i++) {
                    const stone = document.createElement('div');
                    stone.className = 'stone';
                    stone.style.width = (10 + Math.random() * 15) + 'px';
                    stone.style.height = (10 + Math.random() * 15) + 'px';
                    stone.style.left = (20 + Math.random() * 240) + 'px';
                    stone.style.top = (20 + Math.random() * 120) + 'px';
                    
                    // --- Stone Variety Enhancement ---
                    // Randomize grey color
                    const greyValue = 100 + Math.random() * 50; // Range from 100 to 150
                    stone.style.backgroundColor = `rgb(${greyValue}, ${greyValue}, ${greyValue})`;
                    // Add subtle inner shadow
                    stone.style.boxShadow = 'inset 0 1px 2px rgba(0,0,0,0.2)';
                    // --- End Enhancement ---
                    
                    stone.addEventListener('mousedown', function(e) {
                        activeStone = stone;
                        stone.style.zIndex = 2;
                    });
                    
                    zenGarden.appendChild(stone);
                    stones.push(stone);
                }
                
                // Draw some initial lines
                drawZenLines();
                
                // Set up event handlers if they haven't been set up already
                if (!window.zenGardenEventsInitialized) {
                    // Handle stone movement
                    document.addEventListener('mousemove', function(e) {
                        if (activeStone && zenGardenActive) {
                            const rect = zenGarden.getBoundingClientRect();
                            let x = e.clientX - rect.left;
                            let y = e.clientY - rect.top;
                            
                            // Keep stones within garden
                            x = Math.max(10, Math.min(x, rect.width - 10));
                            y = Math.max(10, Math.min(y, rect.height - 10));
                            
                            activeStone.style.left = x + 'px';
                            activeStone.style.top = y + 'px';
                        }
                    });
                    
                    document.addEventListener('mouseup', function() {
                        isRaking = false;
                        if (activeStone) {
                            activeStone.style.zIndex = 1;
                            
                            // Play stone placement sound if sound is enabled
                            if (soundPlaying) {
                                stonePlaceSound.currentTime = 0;
                                stonePlaceSound.play().catch(e => console.log("Could not play stone sound"));
                            }
                            
                            activeStone = null;
                            
                            // Redraw lines when stone is released
                            clearZenLines();
                            drawZenLines();
                        }
                    });
                    
                    // Rake sand (draw lines) on click
                    sand.addEventListener('click', function(e) {
                        if (!activeStone) {
                            const rect = zenGarden.getBoundingClientRect();
                            const x = e.clientX - rect.left;
                            const y = e.clientY - rect.top;
                            
                            drawCircularLines(x, y);
                        }
                    });
                    
                    // --- More Realistic Raking Enhancement ---
                    // Handle mousedown for starting the rake
                    sand.addEventListener('mousedown', function(e) {
                        if (!activeStone) {
                            isRaking = true;
                            const rect = zenGarden.getBoundingClientRect();
                            lastX = e.clientX - rect.left;
                            lastY = e.clientY - rect.top;
                        }
                    });
                    
                    // Handle mousemove for continuous raking
                    sand.addEventListener('mousemove', function(e) {
                        if (isRaking && !activeStone) {
                            const rect = zenGarden.getBoundingClientRect();
                            const x = e.clientX - rect.left;
                            const y = e.clientY - rect.top;
                            
                            // Draw line segment from last position to current position
                            drawRakeLine(lastX, lastY, x, y);
                            
                            // Play rake sound if sound is enabled (only occasionally for better effect)
                            if (soundPlaying && Math.random() < 0.2) {
                                rakeSound.currentTime = 0;
                                rakeSound.play().catch(e => console.log("Could not play rake sound"));
                            }
                            
                            lastX = x;
                            lastY = y;
                        }
                    });
                    
                    // Mark that we've initialized the events
                    window.zenGardenEventsInitialized = true;
                }
            }
            
            function clearZenLines() {
                lines.forEach(line => zenGarden.removeChild(line));
                lines = [];
            }
            
            function drawZenLines() {
                // Draw horizontal lines
                for (let i = 0; i < 10; i++) {
                    const line = document.createElement('div');
                    line.className = 'line';
                    line.style.width = '100%';
                    line.style.height = '1px';
                    line.style.top = (i * 16 + 8) + 'px';
                    line.style.left = '0';
                    
                    // Bend lines around stones
                    stones.forEach(stone => {
                        const stoneTop = parseInt(stone.style.top);
                        const stoneHeight = parseInt(stone.style.height);
                        const lineTop = i * 16 + 8;
                        
                        if (Math.abs(stoneTop - lineTop) < stoneHeight / 2) {
                            const stoneLeft = parseInt(stone.style.left);
                            const stoneWidth = parseInt(stone.style.width);
                            
                            // Create gap for stone
                            line.style.width = (stoneLeft - 5) + 'px';
                            
                            // Create second part of line after stone
                            const line2 = document.createElement('div');
                            line2.className = 'line';
                            line2.style.width = (zenGarden.clientWidth - stoneLeft - stoneWidth - 5) + 'px';
                            line2.style.height = '1px';
                            line2.style.top = lineTop + 'px';
                            line2.style.left = (stoneLeft + stoneWidth + 5) + 'px';
                            
                            zenGarden.appendChild(line2);
                            lines.push(line2);
                        }
                    });
                    
                    zenGarden.appendChild(line);
                    lines.push(line);
                }
            }
            
            function drawCircularLines(x, y) {
                for (let i = 0; i < 3; i++) {
                    const radius = 10 + i * 10;
                    const line = document.createElement('div');
                    line.className = 'line';
                    line.style.width = radius * 2 + 'px';
                    line.style.height = radius * 2 + 'px';
                    line.style.borderRadius = '50%';
                    line.style.border = '1px solid ' + (document.body.classList.contains('dark-mode') ? '#444' : '#e5dbc5');
                    line.style.backgroundColor = 'transparent';
                    line.style.top = (y - radius) + 'px';
                    line.style.left = (x - radius) + 'px';
                    
                    zenGarden.appendChild(line);
                    lines.push(line);
                }
            }
            
            function drawRakeLine(x1, y1, x2, y2) {
                const line = document.createElement('div');
                line.className = 'line';
                
                // Calculate length and angle of the line
                const length = Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
                const angle = Math.atan2(y2 - y1, x2 - x1) * (180 / Math.PI);
                
                // Set line properties
                line.style.width = length + 'px';
                line.style.height = '2px'; // Slightly thicker lines
                line.style.position = 'absolute';
                
                // Set color based on mode
                line.style.backgroundColor = document.body.classList.contains('dark-mode') ? '#444' : '#e5dbc5';
                
                // Position at the start point and rotate
                line.style.top = y1 + 'px';
                line.style.left = x1 + 'px';
                line.style.transformOrigin = '0 0'; // Rotate from start point
                line.style.transform = `rotate(${angle}deg)`;
                
                zenGarden.appendChild(line);
                lines.push(line);
            }
            
            // Falling leaves
            const leavesToggle = document.getElementById('leavesToggle');
            let leavesActive = false;
            let leavesInterval;
            
            leavesToggle.addEventListener('click', function() {
                if (leavesActive) {
                    clearInterval(leavesInterval);
                    const leaves = document.querySelectorAll('.leaf');
                    leaves.forEach(leaf => {
                        if (leaf.parentNode) {
                            leaf.parentNode.removeChild(leaf);
                        }
                    });
                } else {
                    leavesInterval = setInterval(createLeaf, 300);
                }
                leavesActive = !leavesActive;
            });
            
            function createLeaf() {
                const leaf = document.createElement('div');
                leaf.className = 'leaf';
                
                // Randomize leaf properties
                const size = 10 + Math.random() * 15;
                const hue = 60 + Math.random() * 60; // colors from yellow to green
                leaf.style.width = size + 'px';
                leaf.style.height = size + 'px';
                leaf.style.backgroundColor = `hsla(${hue}, 70%, 60%, 0.6)`;
                leaf.style.left = Math.random() * window.innerWidth + 'px';
                leaf.style.top = -30 + 'px';
                
                document.body.appendChild(leaf);
                
                // Animate leaf falling
                const fallDuration = 5000 + Math.random() * 5000;
                const rotation = Math.random() * 360;
                const swayAmount = 100 + Math.random() * 100;
                const swayDuration = 3 + Math.random() * 4;
                
                leaf.style.transition = `top ${fallDuration}ms linear, left ${swayDuration}s ease-in-out, transform ${swayDuration/2}s ease-in-out`;
                
                setTimeout(() => {
                    leaf.style.top = (window.innerHeight + 50) + 'px';
                    animateSway(leaf, swayAmount, swayDuration);
                }, 10);
                
                // Remove leaf after animation completes
                setTimeout(() => {
                    if (leaf.parentNode) {
                        leaf.parentNode.removeChild(leaf);
                    }
                }, fallDuration + 1000);
            }
            
            function animateSway(leaf, amount, duration) {
                const startLeft = parseInt(leaf.style.left);
                let direction = Math.random() > 0.5 ? 1 : -1;
                
                function sway() {
                    const newLeft = startLeft + (direction * amount);
                    const newRotation = 45 + (direction * 20);
                    
                    leaf.style.left = newLeft + 'px';
                    leaf.style.transform = `rotate(${newRotation}deg)`;
                    
                    direction *= -1;
                    
                    if (leaf.parentNode) {
                        setTimeout(sway, duration * 1000 / 2);
                    }
                }
                
                sway();
            }
            
            // Water ripple effect
            document.addEventListener('click', function(e) {
                if (e.target.closest('.controls, .zen-garden, .meditation-timer, .hidden-message')) {
                    return; // Don't create ripples when clicking controls or other interactive elements
                }
                
                createRipple(e.pageX, e.pageY);
            });
            
            function createRipple(x, y) {
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                ripple.style.left = x + 'px';
                ripple.style.top = y + 'px';
                
                document.body.appendChild(ripple);
                
                // Remove ripple after animation
                setTimeout(() => {
                    if (ripple.parentNode) {
                        ripple.parentNode.removeChild(ripple);
                    }
                }, 2000);
            }
            
            // Fireflies in dark mode
            function initFireflies() {
                firefliesActive = true;
                for (let i = 0; i < 25; i++) {
                    createFirefly();
                }
            }
            
            function createFirefly() {
                const firefly = document.createElement('div');
                firefly.className = 'firefly';
                
                // Random position within window
                firefly.style.left = Math.random() * window.innerWidth + 'px';
                firefly.style.top = Math.random() * window.innerHeight + 'px';
                
                document.body.appendChild(firefly);
                fireflies.push(firefly);
                
                animateFirefly(firefly);
            }
            
            function animateFirefly(firefly) {
                if (!firefliesActive) return;
                
                const duration = 3000 + Math.random() * 5000;
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * window.innerHeight;
                const brightness = 0.5 + Math.random() * 0.5;
                
                firefly.style.transition = `left ${duration}ms ease-in-out, top ${duration}ms ease-in-out, opacity 1s ease-in-out`;
                firefly.style.left = x + 'px';
                firefly.style.top = y + 'px';
                firefly.style.opacity = brightness;
                
                setTimeout(() => {
                    if (firefliesActive && firefly.parentNode) {
                        animateFirefly(firefly);
                    }
                }, duration);
            }
            
            function clearFireflies() {
                firefliesActive = false;
                fireflies.forEach(firefly => {
                    if (firefly.parentNode) {
                        firefly.parentNode.removeChild(firefly);
                    }
                });
                fireflies = [];
            }
            
            // Meditation Timer
            const timerToggle = document.getElementById('timerToggle');
            const meditationTimer = document.querySelector('.meditation-timer');
            const timerDisplay = document.querySelector('.timer-display');
            const startTimerBtn = document.getElementById('start-timer');
            const closeTimerBtn = document.getElementById('close-timer');
            const timerOptions = document.querySelectorAll('.timer-option');
            
            let timerMinutes = 5;
            let timerInterval;
            let timerRunning = false;
            
            timerToggle.addEventListener('click', function() {
                meditationTimer.style.display = 'block';
            });
            
            closeTimerBtn.addEventListener('click', function() {
                meditationTimer.style.display = 'none';
                if (timerRunning) {
                    clearInterval(timerInterval);
                    timerRunning = false;
                    startTimerBtn.textContent = 'Start';
                }
            });
            
            timerOptions.forEach(option => {
                option.addEventListener('click', function() {
                    timerOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    timerMinutes = parseInt(this.dataset.time);
                    updateTimerDisplay(timerMinutes, 0);
                });
            });
            
            startTimerBtn.addEventListener('click', function() {
                if (timerRunning) {
                    clearInterval(timerInterval);
                    timerRunning = false;
                    startTimerBtn.textContent = 'Pause';
                } else {
                    let totalSeconds = timerMinutes * 60;
                    timerRunning = true;
                    startTimerBtn.textContent = 'Pause';
                    
                    // Play bell sound at start
                    bellSound.currentTime = 0;
                    bellSound.play().catch(e => console.error("Bell sound playback failed:", e));
                    
                    timerInterval = setInterval(() => {
                        totalSeconds--;
                        
                        if (totalSeconds <= 0) {
                            clearInterval(timerInterval);
                            timerRunning = false;
                            startTimerBtn.textContent = 'Start';
                            
                            // Play bell sound at end
                            bellSound.currentTime = 0;
                            bellSound.play().catch(e => console.error("Bell sound playback failed:", e));
                            
                            // Reset timer to initial value
                            updateTimerDisplay(timerMinutes, 0);
                        } else {
                            const minutes = Math.floor(totalSeconds / 60);
                            const seconds = totalSeconds % 60;
                            updateTimerDisplay(minutes, seconds);
                        }
                    }, 1000);
                }
            });
            
            function updateTimerDisplay(minutes, seconds) {
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // Parallax effect for the background
            let parallaxEnabled = false; // Disabled by default
            
            const parallaxToggle = document.getElementById('parallaxToggle');
            parallaxToggle.addEventListener('click', function() {
                parallaxEnabled = !parallaxEnabled;
                parallaxToggle.textContent = parallaxEnabled ? '🔄' : '🖱️';
                
                // If disabled, reset background position
                if (!parallaxEnabled) {
                    const parallaxBg = document.querySelector('.parallax-bg');
                    parallaxBg.style.transform = 'translate(-10%, -10%)';
                }
            });
            
            document.addEventListener('mousemove', function(e) {
                if (parallaxEnabled) {
                    const parallaxBg = document.querySelector('.parallax-bg');
                    const moveX = (e.clientX / window.innerWidth) * 10 - 5;
                    const moveY = (e.clientY / window.innerHeight) * 10 - 5;
                    
                    parallaxBg.style.transform = `translate(${-10 - moveX}%, ${-10 - moveY}%)`;
                }
            });
            
            // Cosmic meditation mode
            const cosmicToggle = document.getElementById('cosmicToggle');
            const spaceScene = document.getElementById('spaceScene');
            let cosmicActive = false;
            
            cosmicToggle.addEventListener('click', function() {
                console.log("Cosmic toggle clicked. Current state:", cosmicActive);
                
                if (cosmicActive) {
                    // If already active, turn it off
                    console.log("Turning off cosmic mode");
                    cosmicSound.pause();
                    cosmicSound.currentTime = 0;
                    exitCosmicMode();
                    // Hide cosmic volume control
                    cosmicVolumeControl.style.display = 'none';
                } else {
                    // If not active, turn it on
                    console.log("Turning on cosmic mode");
                    cosmicActive = true;
                    
                    // Start the audio
                    cosmicSound.play().catch(e => console.error("Cosmic sound playback failed:", e));
                    
                    // Get the logo element
                    const logoImage = document.querySelector('.logo');
                    
                    // Add transitioning class for smooth fade
                    logoImage.classList.add('logo-transitioning');
                    
                    // Transform the page
                    document.body.classList.add('cosmic-mode');
                    
                    // Debug log for cosmic background
                    console.log("Setting space scene to visible");
                    console.log("Space scene element:", spaceScene);
                    
                    // Make sure space scene is visible
                    spaceScene.style.opacity = '1';
                    spaceScene.style.zIndex = '-1';
                    
                    console.log("Space scene opacity set to:", spaceScene.style.opacity);
                    console.log("Space scene z-index set to:", spaceScene.style.zIndex);
                    
                    // Add cosmic pulse to container
                    document.querySelector('.container').classList.add('cosmic-pulse');
                    
                    // Show cosmic volume control if sound controls are visible
                    if (soundPlaying) {
                        cosmicVolumeControl.style.display = 'block';
                    }
                }
            });
            
            function exitCosmicMode() {
                // Return to normal state
                console.log("Exiting cosmic mode...");
                
                // Get the logo element
                const logoImage = document.querySelector('.logo');
                
                // Start fade out transition
                logoImage.classList.add('logo-transitioning');
                
                // Remove cosmic mode class
                document.body.classList.remove('cosmic-mode');
                
                // Reset space scene
                spaceScene.style.opacity = '0';
                
                // Need a longer delay for the logo to transition back after cosmic mode is removed
                setTimeout(() => {
                    // Force the image back to mountain path manually since CSS content property won't auto-revert
                    logoImage.src = 'mountain-path.jpg';
                    
                    // Remove transition class after a delay so it fades back in
                    setTimeout(() => {
                        logoImage.classList.remove('logo-transitioning');
                    }, 1000);
                }, 1500);
                
                // Reset the z-index after the opacity transition to prevent flicker
                setTimeout(() => {
                    spaceScene.style.zIndex = '-3';
                    console.log("Reset space scene z-index to:", spaceScene.style.zIndex);
                }, 3000);
                
                // Remove the pulse effect from the container
                document.querySelector('.container').classList.remove('cosmic-pulse');
                
                // Set cosmicActive to false after transition completes
                setTimeout(() => {
                    cosmicActive = false;
                    console.log("Cosmic mode deactivated");
                }, 5000); // Match longer transition time
            }
            
            // Get references to the cosmic volume controls
            const cosmicVolumeControl = document.getElementById('cosmic-volume-control');
            const cosmicVolumeSlider = document.getElementById('cosmic-volume-slider');
            
            // Add volume slider event listener
            cosmicVolumeSlider.addEventListener('input', function() {
                cosmicSound.volume = this.value;
            });
            
            // Add ended event listener to cosmic sound
            cosmicSound.addEventListener('ended', function() {
                exitCosmicMode();
            });
        });
    </script>
</body>
</html>