<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enter Zen From There</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f0;
            margin: 0;
            padding: 0;
            background-image: linear-gradient(rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.8)), url('mountain-path.jpg');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            transition: all 0.5s ease;
        }
        
        body.dark-mode {
            color: #f0f0f0;
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('mountain-path.jpg');
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            margin-top: 30px;
            margin-bottom: 30px;
            transition: all 0.5s ease;
        }
        
        body.dark-mode .container {
            background-color: rgba(30, 30, 30, 0.9);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid #ddd;
            transition: all 0.5s ease;
        }
        
        body.dark-mode header {
            border-bottom: 1px solid #444;
        }
        
        h1 {
            font-size: 2.2em;
            margin-bottom: 5px;
            color: #333;
            transition: all 0.5s ease;
        }
        
        body.dark-mode h1 {
            color: #f0f0f0;
        }
        
        h2 {
            font-size: 1.2em;
            font-weight: normal;
            font-style: italic;
            color: #666;
            margin-top: 0;
            transition: all 0.5s ease;
        }
        
        body.dark-mode h2 {
            color: #aaa;
        }
        
        .content {
            padding: 20px 0;
            transition: all 0.5s ease;
        }
        
        p {
            margin-bottom: 1em;
            transition: all 0.5s ease;
            line-height: 1.8;
        }
        
        body.dark-mode p {
            color: #ddd;
        }
        
        footer {
            text-align: center;
            padding: 20px 0;
            color: #666;
            font-size: 0.9em;
            border-top: 1px solid #ddd;
            transition: all 0.5s ease;
        }
        
        body.dark-mode footer {
            color: #aaa;
            border-top: 1px solid #444;
        }
        
        .logo {
            max-width: 80px;
            margin-bottom: 10px;
            border-radius: 50%;
            transition: all 0.5s ease;
        }
        
        @media (max-width: 600px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
        }
        
        /* Toggle buttons */
        .controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border: none;
        }
        
        body.dark-mode .control-btn {
            background-color: rgba(60, 60, 60, 0.8);
            color: #fff;
        }
        
        .control-btn:hover {
            transform: scale(1.1);
        }
        
        /* Breathing circle animation */
        .breathing-circle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(100, 149, 237, 0.5);
            animation: breathing 5s infinite ease-in-out;
            display: none;
        }
        
        @keyframes breathing {
            0% { transform: scale(0.9); background-color: rgba(100, 149, 237, 0.5); }
            25% { transform: scale(1.0); background-color: rgba(100, 149, 237, 0.7); }
            50% { transform: scale(1.2); background-color: rgba(100, 149, 237, 0.9); }
            75% { transform: scale(1.0); background-color: rgba(100, 149, 237, 0.7); }
            100% { transform: scale(0.9); background-color: rgba(100, 149, 237, 0.5); }
        }
        
        /* Fade-in animation for content */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 1.5s ease forwards;
            opacity: 0;
        }
        
        .delay-1 { animation-delay: 0.2s; }
        .delay-2 { animation-delay: 0.4s; }
        .delay-3 { animation-delay: 0.6s; }
        .delay-4 { animation-delay: 0.8s; }
        .delay-5 { animation-delay: 1.0s; }
        
        /* Falling leaves */
        .leaf {
            position: absolute;
            width: 20px;
            height: 20px;
            background: rgba(139, 195, 74, 0.5);
            border-radius: 0 50% 50% 50%;
            transform: rotate(45deg);
            pointer-events: none;
            filter: drop-shadow(0px 0px 1px rgba(0, 0, 0, 0.1));
            z-index: -1;
        }
        
        /* Zen Garden */
        .zen-garden {
            display: none;
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 280px;
            height: 160px;
            background-color: rgba(245, 245, 240, 0.9);
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            z-index: 10;
            transition: all 0.3s ease;
            transform-origin: bottom right;
        }
        
        .zen-garden-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 10px;
            background-color: rgba(200, 200, 200, 0.5);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .zen-garden-title {
            font-size: 0.9em;
            margin: 0;
            font-weight: normal;
        }
        
        .zen-garden-close {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            padding: 0;
            color: #555;
            transition: color 0.3s ease;
        }
        
        .zen-garden-close:hover {
            color: #000;
        }
        
        body.dark-mode .zen-garden-close {
            color: #aaa;
        }
        
        body.dark-mode .zen-garden-close:hover {
            color: #fff;
        }
        
        body.dark-mode .zen-garden-header {
            background-color: rgba(50, 50, 50, 0.5);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.dark-mode .zen-garden {
            background-color: rgba(30, 30, 30, 0.9);
        }
        
        .sand {
            width: 100%;
            height: 100%;
            background-color: #f0e6d2;
            cursor: pointer;
        }
        
        body.dark-mode .sand {
            background-color: #3a3a3a;
        }
        
        .stone {
            position: absolute;
            background-color: #777;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2);
            cursor: grab;
            user-select: none;
        }
        
        .stone:active {
            cursor: grabbing;
        }
        
        .stone:hover {
            filter: brightness(1.1);
        }
        
        /* Sand lines */
        .line {
            position: absolute;
            background-color: #e5dbc5;
            pointer-events: none;
        }
        
        body.dark-mode .line {
            background-color: #444;
        }
        
        /* Hidden message */
        .hidden-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            z-index: 100;
            display: none;
            text-align: center;
            max-width: 400px;
        }
        
        body.dark-mode .hidden-message {
            background-color: rgba(30, 30, 30, 0.95);
        }
        
        .hidden-message p {
            margin-bottom: 15px;
        }
        
        .hidden-message button {
            background-color: #4b79a1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .hidden-message button:hover {
            background-color: #3a678f;
        }
        
        /* Clickable zen words */
        .zen-word {
            text-decoration: none;
            color: inherit;
            border-bottom: 1px dotted #888;
            cursor: pointer;
            position: relative;
        }
        
        .zen-word:hover {
            color: #4b79a1;
        }
        
        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.95);
            padding: 8px 12px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            font-size: 0.9em;
            width: 220px;
            display: none;
            z-index: 100;
            text-align: center;
        }
        
        body.dark-mode .tooltip {
            background-color: rgba(50, 50, 50, 0.95);
        }
        
        .zen-word:hover .tooltip {
            display: block;
        }
        
        /* Water ripples */
        .ripple {
            position: absolute;
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            animation: rippleEffect 2s linear forwards;
            pointer-events: none;
        }
        
        @keyframes rippleEffect {
            0% {
                width: 0;
                height: 0;
                opacity: 0.8;
            }
            100% {
                width: 200px;
                height: 200px;
                opacity: 0;
            }
        }
        
        body.dark-mode .ripple {
            border-color: rgba(150, 180, 255, 0.3);
        }
        
        /* Fireflies */
        .firefly {
            position: fixed;
            width: 3px;
            height: 3px;
            background-color: rgba(255, 255, 190, 0.7);
            border-radius: 50%;
            box-shadow: 0 0 5px 1px rgba(255, 255, 100, 0.5);
            pointer-events: none;
            opacity: 0;
        }
        
        /* Meditation timer */
        .meditation-timer {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            text-align: center;
            z-index: 100;
            width: 300px;
        }
        
        body.dark-mode .meditation-timer {
            background-color: rgba(40, 40, 40, 0.95);
        }
        
        .timer-display {
            font-size: 3rem;
            font-weight: 300;
            margin: 20px 0;
            font-family: monospace;
        }
        
        .timer-controls {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }
        
        .timer-btn {
            background-color: #4b79a1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            width: 80px;
        }
        
        .timer-btn:hover {
            background-color: #3a678f;
        }
        
        .timer-options {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        
        .timer-option {
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid #ddd;
        }
        
        body.dark-mode .timer-option {
            border-color: #555;
        }
        
        .timer-option.active {
            background-color: #4b79a1;
            color: white;
            border-color: #4b79a1;
        }
        
        /* Parallax effect */
        .parallax-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 120%;
            height: 120%;
            background-image: url('mountain-path.jpg');
            background-size: cover;
            z-index: -2;
            transform: translate(-10%, -10%);
        }
        
        body.dark-mode .parallax-bg {
            filter: brightness(0.5) saturate(0.7);
        }
        
        /* Sound control panel */
        .sound-panel {
            display: none;
            position: fixed;
            bottom: 70px;
            right: 20px;
            width: 220px;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        body.dark-mode .sound-panel {
            background-color: rgba(40, 40, 40, 0.95);
        }
        
        .sound-control {
            margin-bottom: 15px;
        }
        
        .sound-control:last-child {
            margin-bottom: 0;
        }
        
        .sound-title {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .sound-toggle {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            color: #4b79a1;
            padding: 0;
            transition: transform 0.2s ease;
        }
        
        .sound-toggle:hover {
            transform: scale(1.1);
        }
        
        .volume-slider {
            width: 100%;
            cursor: pointer;
            margin-top: 5px;
        }
        
        .volume-control {
            display: none;
        }
    </style>
</head>
<body>
    <div class="parallax-bg"></div>
    
    <div class="container">
        <header class="fade-in">
            <img src="mountain-path.jpg" alt="mountain-path Logo" class="logo">
            <h1>Enter Zen From There</h1>
        </header>
        
        <div class="content">
            <p class="fade-in delay-1">A Zen Master was walking in silence with one of his disciples along a mountain trail. When they came to an ancient cedar tree, they sat down under it for a simple meal of some rice and vegetables. After the meal, the disciple, a young monk who had not yet found the key to the mystery of <span class="zen-word">Zen<span class="tooltip">Zen is not something to understand, but to experience directly. It points to your true nature beyond thinking.</span></span>?, broke the silence by asking the Master, "Master, how do I enter Zen?"</p>
            
            <p class="fade-in delay-2">He was, of course, inquiring how to enter the state of <span class="zen-word">consciousness<span class="tooltip">Pure awareness without the interference of thought - your natural state.</span></span> which is Zen.</p>
            
            <p class="fade-in delay-2">The master remained silent. Almost five minutes passed while the disciple anxiously waited for an answer. He was about to ask another question when the Master suddenly spoke. "Do you hear the sound of that mountain stream?"</p>
            
            <p class="fade-in delay-3">The disciple had been busy <span class="zen-word">thinking<span class="tooltip">Thinking is useful, but it can become an obstacle to direct experience. Beyond thinking lies wisdom.</span></span> about the meaning of Zen. Now, as he began to listen to the sound, his noisy mind subsided. At first he heard nothing. Then, his thinking gave way to heightened alertness, and suddenly he did hear the hardly perceptible murmur of a small stream in the far distance.</p>
            
            <p class="fade-in delay-3">"Yes, I can hear it now," he said.</p>
            
            <p class="fade-in delay-4">The Master raised his finger and, with a look in his eyes that in some way was both fierce and gentle, said, "Enter Zen from there."</p>
            
            <p class="fade-in delay-4">The disciple was stunned. It was his first <span class="zen-word">satori<span class="tooltip">Satori is a glimpse of enlightenment - a moment when the veil of thoughts drops and reality is seen directly.</span></span> ‚Äî a flash of enlightenment. He knew what Zen was without knowing what it was that he knew!</p>
            
            <p class="fade-in delay-4">They continued on their journey in silence. The disciple was amazed at the <span class="zen-word">aliveness<span class="tooltip">When mental noise subsides, the world appears vibrant, fresh and alive - as it truly is.</span></span> of the world around him. He experienced everything as if for the first time. Gradually, however, he started thinking again. The alert stillness became covered up again by mental noise, and before long he had another question. "Master," he said, "I have been thinking. What would you have said if I hadn't been able to hear the mountain stream?" The Master stopped, looked at him, raised his finger and said, "Enter Zen from there."</p>
        </div>
        
        <footer class="fade-in delay-5">
            <p>Found this hidden gem? <span id="secret-trigger">Enter Zen from here</span>.</p>
        </footer>
    </div>
    
    <div class="breathing-circle"></div>
    <div class="zen-garden">
        <div class="zen-garden-header">
            <h4 class="zen-garden-title">Zen Garden</h4>
            <button class="zen-garden-close" id="close-zen-garden">√ó</button>
        </div>
        <div class="sand" id="sand"></div>
    </div>
    
    <div class="hidden-message">
        <p>"The true purpose of Zen is to see things as they are, to observe things as they are, and to let everything go as it goes."</p>
        <p>‚Äî Shunryu Suzuki</p>
        <button id="close-message">Continue the journey</button>
    </div>
    
    <div class="meditation-timer">
        <h3>Meditation Timer</h3>
        <div class="timer-options">
            <div class="timer-option active" data-time="5">5 min</div>
            <div class="timer-option" data-time="10">10 min</div>
            <div class="timer-option" data-time="15">15 min</div>
        </div>
        <div class="timer-display">05:00</div>
        <div class="timer-controls">
            <button class="timer-btn" id="start-timer">Start</button>
            <button class="timer-btn" id="close-timer">Close</button>
        </div>
    </div>
    
    <div class="mindful-reading-overlay">
        <div class="mindful-reading-container">
            <h3>Mindful Reading</h3>
            <div class="mindful-text"></div>
            <div class="mindful-controls">
                <button class="mindful-btn" id="prev-mindful">Previous</button>
                <button class="mindful-btn" id="next-mindful">Next</button>
                <button class="mindful-btn" id="close-mindful">Close</button>
            </div>
        </div>
    </div>
    
    <div class="sound-panel" id="sound-panel">
        <div class="sound-control">
            <div class="sound-title">
                <span>Stream Sound</span>
                <button class="sound-toggle" id="stream-toggle">üîá</button>
            </div>
            <input type="range" min="0" max="1" step="0.1" value="0.7" class="volume-slider" id="stream-volume">
        </div>
        <div class="sound-control">
            <div class="sound-title">
                <span>Om Mantra</span>
                <button class="sound-toggle" id="om-toggle">üîá</button>
            </div>
            <input type="range" min="0" max="1" step="0.1" value="0.5" class="volume-slider" id="om-volume">
        </div>
    </div>
    
    <div class="controls">
        <button class="control-btn" id="darkModeToggle" title="Toggle Light/Dark Mode">
            ‚òÄÔ∏è
        </button>
        <button class="control-btn" id="soundPanelToggle" title="Sound Controls">
            üéµ
        </button>
        <button class="control-btn" id="breatheToggle" title="Toggle Breathing Guide">
            ü´Å
        </button>
        <button class="control-btn" id="zenGardenToggle" title="Toggle Zen Garden">
            ü™®
        </button>
        <button class="control-btn" id="leavesToggle" title="Toggle Falling Leaves">
            üçÉ
        </button>
        <button class="control-btn" id="timerToggle" title="Meditation Timer">
            ‚è±Ô∏è
        </button>
    </div>
    
    <audio id="streamSound" loop>
        <source src="https://soundbible.com/mp3/creek-daniel_simon.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="bellSound">
        <source src="https://soundbible.com/mp3/meditative-bell-sound-1-12752.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="omSound" loop>
        <source src="OM.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Dark mode toggle
            const darkModeToggle = document.getElementById('darkModeToggle');
            darkModeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                darkModeToggle.textContent = document.body.classList.contains('dark-mode') ? 'üåô' : '‚òÄÔ∏è';
                
                // Initialize fireflies in dark mode
                if (document.body.classList.contains('dark-mode') && !firefliesActive) {
                    initFireflies();
                } else if (!document.body.classList.contains('dark-mode') && firefliesActive) {
                    clearFireflies();
                }
            });
            
            // Sound panel controls
            const soundPanelToggle = document.getElementById('soundPanelToggle');
            const soundPanel = document.getElementById('sound-panel');
            const streamSound = document.getElementById('streamSound');
            const omSound = document.getElementById('omSound');
            const streamToggle = document.getElementById('stream-toggle');
            const omToggle = document.getElementById('om-toggle');
            const streamVolume = document.getElementById('stream-volume');
            const omVolume = document.getElementById('om-volume');
            
            let soundPanelActive = false;
            let streamPlaying = false;
            let omPlaying = false;
            
            // Initialize sound volumes
            streamSound.volume = 0.7;
            omSound.volume = 0.5;
            
            // Sound panel toggle
            soundPanelToggle.addEventListener('click', function() {
                if (soundPanelActive) {
                    soundPanel.style.display = 'none';
                } else {
                    soundPanel.style.display = 'block';
                }
                soundPanelActive = !soundPanelActive;
            });
            
            // Stream sound toggle
            streamToggle.addEventListener('click', function() {
                if (streamPlaying) {
                    streamSound.pause();
                    streamToggle.textContent = 'üîá';
                } else {
                    streamSound.play().catch(e => console.error("Stream sound playback failed:", e));
                    streamToggle.textContent = 'üîä';
                }
                streamPlaying = !streamPlaying;
                
                // Update main sound button to reflect state
                updateSoundPanelIcon();
            });
            
            // OM sound toggle
            omToggle.addEventListener('click', function() {
                if (omPlaying) {
                    omSound.pause();
                    omToggle.textContent = 'üîá';
                } else {
                    omSound.play().catch(e => console.error("OM sound playback failed:", e));
                    omToggle.textContent = 'üîä';
                }
                omPlaying = !omPlaying;
                
                // Update main sound button to reflect state
                updateSoundPanelIcon();
            });
            
            // Volume sliders
            streamVolume.addEventListener('input', function() {
                streamSound.volume = this.value;
            });
            
            omVolume.addEventListener('input', function() {
                omSound.volume = this.value;
            });
            
            function updateSoundPanelIcon() {
                if (streamPlaying || omPlaying) {
                    soundPanelToggle.textContent = 'üéµ';
                } else {
                    soundPanelToggle.textContent = 'üîá';
                }
            }
            
            // Breathing toggle
            const breatheToggle = document.getElementById('breatheToggle');
            const breathingCircle = document.querySelector('.breathing-circle');
            let breathingActive = false;
            
            breatheToggle.addEventListener('click', function() {
                if (breathingActive) {
                    breathingCircle.style.display = 'none';
                    omSound.pause();
                    omToggle.textContent = 'üîá';
                    omPlaying = false;
                } else {
                    breathingCircle.style.display = 'block';
                    omSound.play().catch(e => console.error("OM sound playback failed:", e));
                    omToggle.textContent = 'üîä';
                    omPlaying = true;
                }
                breathingActive = !breathingActive;
                updateSoundPanelIcon();
            });
            
            // Secret message
            const secretTrigger = document.getElementById('secret-trigger');
            const hiddenMessage = document.querySelector('.hidden-message');
            const closeMessage = document.getElementById('close-message');
            
            secretTrigger.addEventListener('click', function() {
                hiddenMessage.style.display = 'block';
            });
            
            closeMessage.addEventListener('click', function() {
                hiddenMessage.style.display = 'none';
            });
            
            // Zen Garden
            const zenGardenToggle = document.getElementById('zenGardenToggle');
            const zenGarden = document.querySelector('.zen-garden');
            const closeZenGarden = document.getElementById('close-zen-garden');
            let zenGardenActive = false;
            
            zenGardenToggle.addEventListener('click', function() {
                zenGarden.style.display = 'block';
                zenGardenActive = true;
                if (stones.length === 0) {
                    initZenGarden();
                }
            });
            
            closeZenGarden.addEventListener('click', function() {
                zenGarden.style.display = 'none';
                zenGardenActive = false;
            });
            
            const sand = document.getElementById('sand');
            let stones = [];
            let activeStone = null;
            let lines = [];
            
            function initZenGarden() {
                // Create stones
                for (let i = 0; i < 5; i++) {
                    const stone = document.createElement('div');
                    stone.className = 'stone';
                    stone.style.width = (10 + Math.random() * 15) + 'px';
                    stone.style.height = (10 + Math.random() * 15) + 'px';
                    stone.style.left = (20 + Math.random() * 240) + 'px';
                    stone.style.top = (20 + Math.random() * 120) + 'px';
                    
                    stone.addEventListener('mousedown', function(e) {
                        activeStone = stone;
                        stone.style.zIndex = 2;
                    });
                    
                    zenGarden.appendChild(stone);
                    stones.push(stone);
                }
                
                // Draw some initial lines
                drawZenLines();
                
                // Handle stone movement
                document.addEventListener('mousemove', function(e) {
                    if (activeStone && zenGardenActive) {
                        const rect = zenGarden.getBoundingClientRect();
                        let x = e.clientX - rect.left;
                        let y = e.clientY - rect.top;
                        
                        // Keep stones within garden
                        x = Math.max(10, Math.min(x, rect.width - 10));
                        y = Math.max(10, Math.min(y, rect.height - 10));
                        
                        activeStone.style.left = x + 'px';
                        activeStone.style.top = y + 'px';
                    }
                });
                
                document.addEventListener('mouseup', function() {
                    if (activeStone) {
                        activeStone.style.zIndex = 1;
                        activeStone = null;
                        
                        // Redraw lines when stone is released
                        clearZenLines();
                        drawZenLines();
                    }
                });
                
                // Rake sand (draw lines) on click
                sand.addEventListener('click', function(e) {
                    if (!activeStone) {
                        const rect = zenGarden.getBoundingClientRect();
                        const x = e.clientX - rect.left;
                        const y = e.clientY - rect.top;
                        
                        drawCircularLines(x, y);
                    }
                });
            }
            
            function clearZenLines() {
                lines.forEach(line => zenGarden.removeChild(line));
                lines = [];
            }
            
            function drawZenLines() {
                // Draw horizontal lines
                for (let i = 0; i < 10; i++) {
                    const line = document.createElement('div');
                    line.className = 'line';
                    line.style.width = '100%';
                    line.style.height = '1px';
                    line.style.top = (i * 16 + 8) + 'px';
                    line.style.left = '0';
                    
                    // Bend lines around stones
                    stones.forEach(stone => {
                        const stoneTop = parseInt(stone.style.top);
                        const stoneHeight = parseInt(stone.style.height);
                        const lineTop = i * 16 + 8;
                        
                        if (Math.abs(stoneTop - lineTop) < stoneHeight / 2) {
                            const stoneLeft = parseInt(stone.style.left);
                            const stoneWidth = parseInt(stone.style.width);
                            
                            // Create gap for stone
                            line.style.width = (stoneLeft - 5) + 'px';
                            
                            // Create second part of line after stone
                            const line2 = document.createElement('div');
                            line2.className = 'line';
                            line2.style.width = (zenGarden.clientWidth - stoneLeft - stoneWidth - 5) + 'px';
                            line2.style.height = '1px';
                            line2.style.top = lineTop + 'px';
                            line2.style.left = (stoneLeft + stoneWidth + 5) + 'px';
                            
                            zenGarden.appendChild(line2);
                            lines.push(line2);
                        }
                    });
                    
                    zenGarden.appendChild(line);
                    lines.push(line);
                }
            }
            
            function drawCircularLines(x, y) {
                for (let i = 0; i < 3; i++) {
                    const radius = 10 + i * 10;
                    const line = document.createElement('div');
                    line.className = 'line';
                    line.style.width = radius * 2 + 'px';
                    line.style.height = radius * 2 + 'px';
                    line.style.borderRadius = '50%';
                    line.style.border = '1px solid ' + (document.body.classList.contains('dark-mode') ? '#444' : '#e5dbc5');
                    line.style.backgroundColor = 'transparent';
                    line.style.top = (y - radius) + 'px';
                    line.style.left = (x - radius) + 'px';
                    
                    zenGarden.appendChild(line);
                    lines.push(line);
                }
            }
            
            // Falling leaves
            const leavesToggle = document.getElementById('leavesToggle');
            let leavesActive = false;
            let leavesInterval;
            
            leavesToggle.addEventListener('click', function() {
                if (leavesActive) {
                    clearInterval(leavesInterval);
                    const leaves = document.querySelectorAll('.leaf');
                    leaves.forEach(leaf => {
                        if (leaf.parentNode) {
                            leaf.parentNode.removeChild(leaf);
                        }
                    });
                } else {
                    leavesInterval = setInterval(createLeaf, 300);
                }
                leavesActive = !leavesActive;
            });
            
            function createLeaf() {
                const leaf = document.createElement('div');
                leaf.className = 'leaf';
                
                // Randomize leaf properties
                const size = 10 + Math.random() * 15;
                const hue = 60 + Math.random() * 60; // colors from yellow to green
                leaf.style.width = size + 'px';
                leaf.style.height = size + 'px';
                leaf.style.backgroundColor = `hsla(${hue}, 70%, 60%, 0.6)`;
                leaf.style.left = Math.random() * window.innerWidth + 'px';
                leaf.style.top = -30 + 'px';
                
                document.body.appendChild(leaf);
                
                // Animate leaf falling
                const fallDuration = 5000 + Math.random() * 5000;
                const rotation = Math.random() * 360;
                const swayAmount = 100 + Math.random() * 100;
                const swayDuration = 3 + Math.random() * 4;
                
                leaf.style.transition = `top ${fallDuration}ms linear, left ${swayDuration}s ease-in-out, transform ${swayDuration/2}s ease-in-out`;
                
                setTimeout(() => {
                    leaf.style.top = (window.innerHeight + 50) + 'px';
                    animateSway(leaf, swayAmount, swayDuration);
                }, 10);
                
                // Remove leaf after animation completes
                setTimeout(() => {
                    if (leaf.parentNode) {
                        leaf.parentNode.removeChild(leaf);
                    }
                }, fallDuration + 1000);
            }
            
            function animateSway(leaf, amount, duration) {
                const startLeft = parseInt(leaf.style.left);
                let direction = Math.random() > 0.5 ? 1 : -1;
                
                function sway() {
                    const newLeft = startLeft + (direction * amount);
                    const newRotation = 45 + (direction * 20);
                    
                    leaf.style.left = newLeft + 'px';
                    leaf.style.transform = `rotate(${newRotation}deg)`;
                    
                    direction *= -1;
                    
                    if (leaf.parentNode) {
                        setTimeout(sway, duration * 1000 / 2);
                    }
                }
                
                sway();
            }
            
            // Water ripple effect
            document.addEventListener('click', function(e) {
                if (e.target.closest('.controls, .zen-garden, .meditation-timer, .hidden-message, .mindful-reading-overlay')) {
                    return; // Don't create ripples when clicking controls or other interactive elements
                }
                
                createRipple(e.pageX, e.pageY);
            });
            
            function createRipple(x, y) {
                const ripple = document.createElement('div');
                ripple.className = 'ripple';
                ripple.style.left = x + 'px';
                ripple.style.top = y + 'px';
                
                document.body.appendChild(ripple);
                
                // Remove ripple after animation
                setTimeout(() => {
                    if (ripple.parentNode) {
                        ripple.parentNode.removeChild(ripple);
                    }
                }, 2000);
            }
            
            // Fireflies in dark mode
            let firefliesActive = false;
            let fireflies = [];
            
            function initFireflies() {
                firefliesActive = true;
                for (let i = 0; i < 25; i++) {
                    createFirefly();
                }
            }
            
            function createFirefly() {
                const firefly = document.createElement('div');
                firefly.className = 'firefly';
                
                // Random position within window
                firefly.style.left = Math.random() * window.innerWidth + 'px';
                firefly.style.top = Math.random() * window.innerHeight + 'px';
                
                document.body.appendChild(firefly);
                fireflies.push(firefly);
                
                animateFirefly(firefly);
            }
            
            function animateFirefly(firefly) {
                if (!firefliesActive) return;
                
                const duration = 3000 + Math.random() * 5000;
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * window.innerHeight;
                const brightness = 0.5 + Math.random() * 0.5;
                
                firefly.style.transition = `left ${duration}ms ease-in-out, top ${duration}ms ease-in-out, opacity 1s ease-in-out`;
                firefly.style.left = x + 'px';
                firefly.style.top = y + 'px';
                firefly.style.opacity = brightness;
                
                setTimeout(() => {
                    if (firefliesActive && firefly.parentNode) {
                        animateFirefly(firefly);
                    }
                }, duration);
            }
            
            function clearFireflies() {
                firefliesActive = false;
                fireflies.forEach(firefly => {
                    if (firefly.parentNode) {
                        firefly.parentNode.removeChild(firefly);
                    }
                });
                fireflies = [];
            }
            
            // Meditation Timer
            const timerToggle = document.getElementById('timerToggle');
            const meditationTimer = document.querySelector('.meditation-timer');
            const timerDisplay = document.querySelector('.timer-display');
            const startTimerBtn = document.getElementById('start-timer');
            const closeTimerBtn = document.getElementById('close-timer');
            const timerOptions = document.querySelectorAll('.timer-option');
            const bellSound = document.getElementById('bellSound');
            
            let timerMinutes = 5;
            let timerInterval;
            let timerRunning = false;
            
            timerToggle.addEventListener('click', function() {
                meditationTimer.style.display = 'block';
            });
            
            closeTimerBtn.addEventListener('click', function() {
                meditationTimer.style.display = 'none';
                if (timerRunning) {
                    clearInterval(timerInterval);
                    timerRunning = false;
                    startTimerBtn.textContent = 'Start';
                }
            });
            
            timerOptions.forEach(option => {
                option.addEventListener('click', function() {
                    timerOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    timerMinutes = parseInt(this.dataset.time);
                    updateTimerDisplay(timerMinutes, 0);
                });
            });
            
            startTimerBtn.addEventListener('click', function() {
                if (timerRunning) {
                    clearInterval(timerInterval);
                    timerRunning = false;
                    startTimerBtn.textContent = 'Start';
                } else {
                    let totalSeconds = timerMinutes * 60;
                    timerRunning = true;
                    startTimerBtn.textContent = 'Pause';
                    
                    // Play bell sound at start
                    bellSound.currentTime = 0;
                    bellSound.play().catch(e => console.error("Bell sound playback failed:", e));
                    
                    timerInterval = setInterval(() => {
                        totalSeconds--;
                        
                        if (totalSeconds <= 0) {
                            clearInterval(timerInterval);
                            timerRunning = false;
                            startTimerBtn.textContent = 'Start';
                            
                            // Play bell sound at end
                            bellSound.currentTime = 0;
                            bellSound.play().catch(e => console.error("Bell sound playback failed:", e));
                            
                            // Reset timer to initial value
                            updateTimerDisplay(timerMinutes, 0);
                        } else {
                            const minutes = Math.floor(totalSeconds / 60);
                            const seconds = totalSeconds % 60;
                            updateTimerDisplay(minutes, seconds);
                        }
                    }, 1000);
                }
            });
            
            function updateTimerDisplay(minutes, seconds) {
                timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            // Mindful Reading Mode
            const mindfulToggle = document.getElementById('mindfulToggle');
            const mindfulOverlay = document.querySelector('.mindful-reading-overlay');
            const mindfulText = document.querySelector('.mindful-text');
            const prevMindfulBtn = document.getElementById('prev-mindful');
            const nextMindfulBtn = document.getElementById('next-mindful');
            const closeMindfulBtn = document.getElementById('close-mindful');
            
            // Break story into mindful reading segments
            const storyParagraphs = [
                "A Zen Master was walking in silence with one of his disciples along a mountain trail.",
                "When they came to an ancient cedar tree, they sat down under it for a simple meal of some rice and vegetables.",
                "After the meal, the disciple, a young monk who had not yet found the key to the mystery of Zen, broke the silence by asking the Master, \"Master, how do I enter Zen?\"",
                "He was, of course, inquiring how to enter the state of consciousness which is Zen.",
                "The master remained silent.",
                "Almost five minutes passed while the disciple anxiously waited for an answer.",
                "He was about to ask another question when the Master suddenly spoke. \"Do you hear the sound of that mountain stream?\"",
                "The disciple had been busy thinking about the meaning of Zen.",
                "Now, as he began to listen to the sound, his noisy mind subsided.",
                "At first he heard nothing.",
                "Then, his thinking gave way to heightened alertness, and suddenly he did hear the hardly perceptible murmur of a small stream in the far distance.",
                "\"Yes, I can hear it now,\" he said.",
                "The Master raised his finger and, with a look in his eyes that in some way was both fierce and gentle, said, \"Enter Zen from there.\"",
                "The disciple was stunned. It was his first satori ‚Äî a flash of enlightenment.",
                "He knew what Zen was without knowing what it was that he knew!",
                "They continued on their journey in silence.",
                "The disciple was amazed at the aliveness of the world around him. He experienced everything as if for the first time.",
                "Gradually, however, he started thinking again. The alert stillness became covered up again by mental noise.",
                "Before long he had another question. \"Master,\" he said, \"I have been thinking. What would you have said if I hadn't been able to hear the mountain stream?\"",
                "The Master stopped, looked at him, raised his finger and said, \"Enter Zen from there.\""
            ];
            
            let currentMindfulIndex = 0;
            
            mindfulToggle.addEventListener('click', function() {
                mindfulOverlay.style.display = 'flex';
                currentMindfulIndex = 0;
                updateMindfulText();
            });
            
            closeMindfulBtn.addEventListener('click', function() {
                mindfulOverlay.style.display = 'none';
            });
            
            prevMindfulBtn.addEventListener('click', function() {
                if (currentMindfulIndex > 0) {
                    currentMindfulIndex--;
                    updateMindfulText();
                }
            });
            
            nextMindfulBtn.addEventListener('click', function() {
                if (currentMindfulIndex < storyParagraphs.length - 1) {
                    currentMindfulIndex++;
                    updateMindfulText();
                }
            });
            
            function updateMindfulText() {
                mindfulText.textContent = storyParagraphs[currentMindfulIndex];
                
                // Update button states
                prevMindfulBtn.disabled = currentMindfulIndex === 0;
                nextMindfulBtn.disabled = currentMindfulIndex === storyParagraphs.length - 1;
            }
            
            // Parallax effect for the background
            document.addEventListener('mousemove', function(e) {
                const parallaxBg = document.querySelector('.parallax-bg');
                const moveX = (e.clientX / window.innerWidth) * 10 - 5;
                const moveY = (e.clientY / window.innerHeight) * 10 - 5;
                
                parallaxBg.style.transform = `translate(${-10 - moveX}%, ${-10 - moveY}%)`;
            });
            
            // Easter egg: Konami code
            let konamiSequence = [];
            const konami = [38, 38, 40, 40, 37, 39, 37, 39, 66, 65]; // up up down down left right left right B A
            
            document.addEventListener('keydown', function(e) {
                konamiSequence.push(e.keyCode);
                
                // Keep only the last N keypresses
                if (konamiSequence.length > konami.length) {
                    konamiSequence.shift();
                }
                
                // Check if sequence matches
                if (konamiSequence.join(',') === konami.join(',')) {
                    // Activate all features at once
                    if (!soundPlaying) soundToggle.click();
                    if (!breathingActive) breatheToggle.click();
                    if (!zenGardenActive) zenGardenToggle.click();
                    if (!leavesActive) leavesToggle.click();
                    
                    // Show a special message
                    alert('You have discovered the path to enlightenment! All elements are now in harmony.');
                    
                    // Reset sequence
                    konamiSequence = [];
                }
            });
            
            // Easter egg: Hidden messages after time spent
            setTimeout(function() {
                if (!document.hidden) {
                    const quotes = [
                        "The mind is everything. What you think you become. - Buddha",
                        "When you realize nothing is lacking, the whole world belongs to you. - Lao Tzu",
                        "Before enlightenment, chop wood, carry water. After enlightenment, chop wood, carry water.",
                        "The obstacle is the path.",
                        "When the student is ready, the teacher will appear."
                    ];
                    
                    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                    
                    const notification = document.createElement('div');
                    notification.style.position = 'fixed';
                    notification.style.bottom = '20px';
                    notification.style.left = '20px';
                    notification.style.padding = '10px 15px';
                    notification.style.backgroundColor = document.body.classList.contains('dark-mode') ? 'rgba(30, 30, 30, 0.9)' : 'rgba(255, 255, 255, 0.9)';
                    notification.style.color = document.body.classList.contains('dark-mode') ? '#ddd' : '#333';
                    notification.style.borderRadius = '5px';
                    notification.style.boxShadow = '0 2px 10px rgba(0, 0, 0, 0.2)';
                    notification.style.zIndex = '100';
                    notification.style.maxWidth = '300px';
                    notification.style.animation = 'fadeIn 0.5s ease';
                    notification.textContent = randomQuote;
                    
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        notification.style.opacity = '0';
                        notification.style.transition = 'opacity 0.5s ease';
                        
                        setTimeout(() => {
                            if (notification.parentNode) {
                                notification.parentNode.removeChild(notification);
                            }
                        }, 500);
                    }, 8000);
                }
            }, 60000); // Show after 1 minute
        });
    </script>
</body>
</html> 